<?xml version="1.0" ?>
<ItemRenderer>
  <Data>
    <Sprite name="s_Ketchup" fileName="game/player_cosmetics4.rttex" textureSize="32,32" frame="17,2" />
    <Sprite name="s_Mustard" fileName="game/player_cosmetics4.rttex" textureSize="32,32" frame="18,2" />
    <Sprite name="s_ProjectileKetchup" fileName="game/particles12.rttex" textureSize="32,32" frame="28,9" />
    <Sprite name="s_ProjectileMustard" fileName="game/particles12.rttex" textureSize="32,32" frame="29,9" />

    <StateMachines>
      <StateMachine name="Punch">
        <States>
          <State name="True"/>
          <State name="False"/>
        </States>
        <Transitions>
          <Transition from="False" to="True">
            <Condition type="and">
              <IsAction>PUNCH</IsAction>
              <IsZombified>false</IsZombified>
            </Condition>
          </Transition>
          <Transition from="True" to="False">
            <Condition>
              <IsAction operatorType="NotEqual">PUNCH</IsAction>
            </Condition>
          </Transition>
        </Transitions>
      </StateMachine>
    </StateMachines>

    <ParticleSystems>
      <ParticleSystem name="ps_ketchup" updateStage="RenderHandItem" updateState="Punch.True">
        <Emitter attachment="handspotRoot">
          <Set name="lifeTime">0.072</Set>
          <Set name="infParticles">true</Set>
          <Set name="checkParticleNumToEmit">true</Set>
          <Set name="particlesPerEmission">1</Set>
          <Set name="particlesToEmit">1</Set>
          <Set name="offset">7,10</Set>
        </Emitter>
        <Particle>
          <Set name="sprite">s_ProjectileKetchup</Set>
          <Set name="blendingMode">PREMULTIPLIED_ALPHA</Set>
          <Set name="rotateWithVelocity">true</Set>
          <Set name="lifeTime">0.2</Set>
          <Random name="targetPosOffset" min="-15, -8" max="15, 8"/>
          <VectorTo name="initialVelocity" source="targetPos" offset="targetPosOffset" duration="lifeTime" x="1"/>
          <OnFinish>
            <ParticleSystemName>ps_ketchupSplash</ParticleSystemName>
          </OnFinish>
        </Particle>
      </ParticleSystem>
      <ParticleSystem name="ps_ketchupSplash" >
        <Emitter>
          <Set name="lifeTime">1</Set>
          <Set name="emissionInterval">0.5</Set>
          <Random name="particlesPerEmission" min="1" max="4"/>
        </Emitter>
        <Particle>
          <Set name="sprite">s_ProjectileKetchup</Set>
          <Set name="rotateWithVelocity">true</Set>
          <Set name="blendingMode">PREMULTIPLIED_ALPHA</Set>
          <Curve name="initialAlpha">
            <KeyFrame>0, 1</KeyFrame>
            <KeyFrame>1, 0</KeyFrame>
          </Curve>
          <Set name="useGravity">true</Set>
          <Curve name="initialScale">
            <KeyFrame>0, 0.75, 0.75</KeyFrame>
            <KeyFrame>1, 0.25, 0.25</KeyFrame>
          </Curve>
          <Set name="lifeTime">1</Set>
          <RandomRadial name="initialVelocity" angleRange="0,360" radiusRange="25,75" baseAnglePosition="targetPos" baseOffset="0,16"/>
          <Set name="gravityVector">0, 45</Set>
        </Particle>
      </ParticleSystem>
      <ParticleSystem name="ps_mustard" updateStage="RenderBackHandItem" updateState="Punch.True">
        <Emitter attachment="handspotRoot">
          <Set name="lifeTime">0.072</Set>
          <Set name="infParticles">true</Set>
          <Set name="checkParticleNumToEmit">true</Set>
          <Set name="particlesPerEmission">1</Set>
          <Set name="particlesToEmit">1</Set>
          <Set name="offset">4,10</Set>
        </Emitter>
        <Particle>
          <Set name="sprite">s_ProjectileMustard</Set>
          <Set name="blendingMode">PREMULTIPLIED_ALPHA</Set>
          <Set name="rotateWithVelocity">true</Set>
          <Set name="lifeTime">0.2</Set>
          <Random name="targetPosOffset" min="-15, -8" max="15, 8"/>
          <VectorTo name="initialVelocity" source="targetPos" offset="targetPosOffset" duration="lifeTime" x="1"/>
          <OnFinish>
            <ParticleSystemName>ps_mustardSplash</ParticleSystemName>
          </OnFinish>
        </Particle>
      </ParticleSystem>
      <ParticleSystem name="ps_mustardSplash" >
        <Emitter>
          <Set name="lifeTime">1</Set>
          <Set name="emissionInterval">0.5</Set>
          <Random name="particlesPerEmission" min="1" max="4"/>
        </Emitter>
        <Particle>
          <Set name="sprite">s_ProjectileMustard</Set>
          <Set name="rotateWithVelocity">true</Set>
          <Set name="blendingMode">PREMULTIPLIED_ALPHA</Set>
          <Curve name="initialAlpha">
            <KeyFrame>0, 1</KeyFrame>
            <KeyFrame>1, 0</KeyFrame>
          </Curve>
          <Set name="useGravity">true</Set>
          <Curve name="initialScale">
            <KeyFrame>0, 0.75, 0.75</KeyFrame>
            <KeyFrame>1, 0.25, 0.25</KeyFrame>
          </Curve>
          <Set name="lifeTime">1</Set>
          <RandomRadial name="initialVelocity" angleRange="0,360" radiusRange="25,75" baseAnglePosition="targetPos" baseOffset="0,16"/>
          <Set name="gravityVector">0, 45</Set>
        </Particle>
      </ParticleSystem>
    </ParticleSystems>

    <RenderOptions>
      <Default>
        <Set name="PunchSoundOverride">HAND</Set>
        <Set name="PlayDefaultPunchAudio">false</Set>
        <Set name="RenderBackArmInfected">true</Set>
        <Set name="RenderFrontArmInfected">true</Set>
        <Set name="RenderBackArmBuild">true</Set>
        <Set name="IncludeAllActions">true</Set>
        <Set name="DefaultRenderMannequinHandItem">false</Set>
        <Set name="RenderFrontArmInTheFront">true</Set>
        <Set name="RenderBackArmAfterItem">true</Set>
      </Default>
    </RenderOptions>
  </Data>
  <RenderRules>
    <RenderHandItem>
      <Translate forceValue="false">1,16,0</Translate>
      <SpriteRender name="s_Ketchup" blend="NORMAL" alignment="CENTER" drawShadow="true" />
    </RenderHandItem>
    <RenderBackHandItem>
      <StopIf>
        <IsAction>BUILD</IsAction>
      </StopIf>
      <StopIf type="and">
        <IsZombified>true</IsZombified>
        <IsAction>PUNCH</IsAction>
      </StopIf>
      <Translate forceValue="false">-4,5,0</Translate>
      <SpriteRender name="s_Mustard" blend="NORMAL" alignment="CENTER" drawShadow="true" />
    </RenderBackHandItem>
    <OnPunchUpdate>
      <StopIf>
        <IsZombified>true</IsZombified>
      </StopIf>
      <AvatarTransform class="Face">
        <Set name="face">MAD</Set>
      </AvatarTransform>
      <AvatarTransform class="ArmAngle">
        <Set name="armName">arm1Angle</Set>
        <Set name="pointTowardsPunchTarget">true</Set>
      </AvatarTransform>
      <AvatarTransform class="ArmAngle">
        <Set name="armName">arm2Angle</Set>
        <Set name="pointTowardsPunchTarget">true</Set>
      </AvatarTransform>
    </OnPunchUpdate>
    <OnDamagedTile>
      <ParticleSystemUpdate name="ps_ketchupSplash"/>
    </OnDamagedTile>
    <OnDestroyedTile>
      <ParticleSystemUpdate name="ps_ketchupSplash"/>
    </OnDestroyedTile>
  </RenderRules>
</ItemRenderer>
