<?xml version="1.0" encoding="utf-8"?>
<ItemRenderer>
  <Data>
    <Sprite name="s_chest" fileName="game/player_cosmetics4.rttex" textureSize="32" frame="24,3"/>
    <Sprite name="s_glow" fileName="game/particles_large17.rttex" textureSize="64" frame="9,3"/>
    <Sprite name="s_snowflake" fileName="game/particles12.rttex" textureSize="32" frame="23,11"/>
    <Sprite name="s_trail" fileName="game/particles12.rttex" textureSize="32" frame="24,11"/>
    <Sprite name="s_flash" fileName="game/particles12.rttex" textureSize="64" frame="26,11"/>
    <Sprite name="s_outline" fileName="game/particles_large17.rttex" textureSize="64" frame="8,3"/>
    <Sprite name="s_death" fileName="game/particles_large17.rttex" textureSize="64" frame="8,2" />

    <Animations>
      <SpriteAnimation name="a_trail" sprite="s_trail" isLoop="true" animTime="300">
        <Frame>24,11</Frame>
        <Frame>25,11</Frame>
      </SpriteAnimation>
      <CurveAnimationFloat name="snowflake_angle_rotation" autoPlay="true" isLoop="true" animTime="4000">
        <Curve name="snowflake_angle">
          <KeyFrame>0, 0</KeyFrame>
          <KeyFrame>1, 360</KeyFrame>
        </Curve>
      </CurveAnimationFloat>
      <SpriteAnimation name="a_death" sprite="s_death" animTime="1200">
        <Frame>15,2</Frame>
        <Frame>8,2</Frame>
        <Frame>9,2</Frame>
        <Frame>10,2</Frame>
        <Frame>11,2</Frame>
        <Frame>12,2</Frame>
        <Frame>13,2</Frame>
        <Frame>14,2</Frame>
		<Frame>15,2</Frame>
		<Frame>14,2</Frame>
		<Frame>15,2</Frame>
		<Frame>14,2</Frame>
      </SpriteAnimation>
    </Animations>

    <StateMachines>
      <StateMachine name="IsDying">
        <States>
          <State name="False" />
          <State name="True" />
        </States>
        <Transitions>
          <Transition from="False" to="True">
            <Condition>
              <IsAction>DIE</IsAction>
            </Condition>
          </Transition>
          <Transition from="True" to="False">
            <Condition>
              <IsAction operatorType="NotEqual">DIE</IsAction>
            </Condition>
          </Transition>
        </Transitions>
      </StateMachine>
    </StateMachines>

    <VariableMap>
      <Set name="snowflake_angle">0</Set>
    </VariableMap>

    <ParticleSystems>
      <ParticleSystem name="ps_snowflake">
        <Emitter>
          <Set name="offset">0, -16</Set>
          <Set name="emissionInterval">0.04</Set>
          <Set name="infParticles">true</Set>
          <Set name="infLifeTime">true</Set>
          <Set name="particlesPerEmission">1</Set>
          <OrbitOffset>
            <Set name="maxScale">0.7f</Set>
            <Set name="hasOrbit">true</Set>
            <Set name="hOrbitPeriod">5000</Set>
            <Set name="hAmplitude">18</Set>
            <Set name="hTimeOffset">0</Set>
            <Set name="vAmplitude">10</Set>
            <Set name="vOrbitPeriod">5000</Set>
            <Set name="vTimeOffset">0</Set>
            <Set name="minScale">0.4</Set>
          </OrbitOffset>
        </Emitter>
        <Particle>
          <Set name="sprite">s_snowflake</Set>
          <Set name="relativeToEmitter">true</Set>
          <Set name="inSpecificOrder">false</Set>
          <Set name="blendingMode">PREMULTIPLIED_ALPHA</Set>
          <Set name="lifeTime">0.06</Set>
          <Set name="initialAngle" source="snowflake_angle"/>
        </Particle>
      </ParticleSystem>

      <ParticleSystem name="ps_trail">
        <Emitter>
          <Set name="offset">0, -16</Set>
          <Set name="emissionInterval">0.1</Set>
          <Set name="infParticles">true</Set>
          <Set name="infLifeTime">true</Set>
          <Set name="particlesPerEmission">1</Set>
          <OrbitOffset>
            <Set name="maxScale">0.7f</Set>
            <Set name="hasOrbit">true</Set>
            <Set name="hOrbitPeriod">5000</Set>
            <Set name="hAmplitude">18</Set>
            <Set name="hTimeOffset">0</Set>
            <Set name="vAmplitude">10</Set>
            <Set name="vOrbitPeriod">5000</Set>
            <Set name="vTimeOffset">0</Set>
            <Set name="minScale">0.4</Set>
          </OrbitOffset>
        </Emitter>
        <Particle>
          <Set name="sprite">s_trail</Set>
          <Set name="inSpecificOrder">false</Set>
          <Set name="blendingMode">PREMULTIPLIED_ALPHA</Set>
          <Curve name="initialAlpha">
            <KeyFrame>0, 1</KeyFrame>
            <KeyFrame>1, 0</KeyFrame>
          </Curve>
          <Curve name="initialRotationRate">
            <KeyFrame>0, 15</KeyFrame>
            <KeyFrame>1, 5</KeyFrame>
          </Curve>
          <Random name="initialAngle" min="0" max="360" />
          <Random name="finalAngle" min="0" max="360" />
          <Set name="interpolateAngle">true</Set>
          <Set name="initialScale">0.6,0.6</Set>
          <Random name="finalScale" min="0.1" max="0.3" />
          <Set name="interpolateScale">true</Set>
          <Random name="offset" min="-2,-3" max="2,3" />
          <Set name="lifeTime">1</Set>
        </Particle>
      </ParticleSystem>
      <ParticleSystem name="ps_snowflake1">
        <Emitter>
          <Set name="offset">0, -16</Set>
          <Set name="emissionInterval">0.04</Set>
          <Set name="infParticles">true</Set>
          <Set name="infLifeTime">true</Set>
          <Set name="particlesPerEmission">1</Set>
          <OrbitOffset>
            <Set name="maxScale">0.7f</Set>
            <Set name="hasOrbit">true</Set>
            <Set name="hOrbitPeriod">5000</Set>
            <Set name="hAmplitude">18</Set>
            <Set name="hTimeOffset">2500</Set>
            <Set name="vAmplitude">10</Set>
            <Set name="vOrbitPeriod">5000</Set>
            <Set name="vTimeOffset">2500</Set>
            <Set name="minScale">0.4</Set>
          </OrbitOffset>
        </Emitter>
        <Particle>
          <Set name="sprite">s_snowflake</Set>
          <Set name="relativeToEmitter">true</Set>
          <Set name="inSpecificOrder">false</Set>
          <Set name="blendingMode">PREMULTIPLIED_ALPHA</Set>
          <Set name="lifeTime">0.06</Set>
          <Set name="initialAngle" source="snowflake_angle"/>
        </Particle>
      </ParticleSystem>

      <ParticleSystem name="ps_trail1">
        <Emitter>
          <Set name="offset">0, -16</Set>
          <Set name="emissionInterval">0.1</Set>
          <Set name="infParticles">true</Set>
          <Set name="infLifeTime">true</Set>
          <Set name="particlesPerEmission">1</Set>
          <OrbitOffset>
            <Set name="maxScale">0.7f</Set>
            <Set name="hasOrbit">true</Set>
            <Set name="hOrbitPeriod">5000</Set>
            <Set name="hAmplitude">18</Set>
            <Set name="hTimeOffset">2500</Set>
            <Set name="vAmplitude">10</Set>
            <Set name="vOrbitPeriod">5000</Set>
            <Set name="vTimeOffset">2500</Set>
            <Set name="minScale">0.4</Set>
          </OrbitOffset>
        </Emitter>
        <Particle>
          <Set name="sprite">s_trail</Set>
          <Set name="inSpecificOrder">false</Set>
          <Set name="blendingMode">PREMULTIPLIED_ALPHA</Set>
          <Curve name="initialAlpha">
            <KeyFrame>0, 1</KeyFrame>
            <KeyFrame>1, 0</KeyFrame>
          </Curve>
          <Curve name="initialRotationRate">
            <KeyFrame>0, 15</KeyFrame>
            <KeyFrame>1, 5</KeyFrame>
          </Curve>
          <Random name="initialAngle" min="0" max="360" />
          <Random name="finalAngle" min="0" max="360" />
          <Set name="interpolateAngle">true</Set>
          <Set name="initialScale">0.6,0.6</Set>
          <Random name="finalScale" min="0.1" max="0.3" />
          <Set name="interpolateScale">true</Set>
          <Random name="offset" min="-2,-3" max="2,3" />
          <Set name="lifeTime">1</Set>
        </Particle>
      </ParticleSystem>

      <ParticleSystem name="ps_flash">
        <Emitter>
          <Set name="offset">0, -16</Set>
          <Set name="emissionInterval">0.1</Set>
          <Set name="infParticles">true</Set>
          <Set name="infLifeTime">true</Set>
          <Set name="checkParticleNumToEmit">true</Set>
          <Set name="particlesPerEmission">1</Set>
          <Set name="particlesToEmit">1</Set>
        </Emitter>
        <Particle usePlayerFacing="true">
          <Set name="sprite">s_flash</Set>
          <Set name="blendingMode">PREMULTIPLIED_ALPHA</Set>
          <Set name="relativeToEmitter">true</Set>
          <Curve name="initialAlpha">
            <KeyFrame>0, 1</KeyFrame>
            <KeyFrame>0.4, 1</KeyFrame>
            <KeyFrame>1, 0</KeyFrame>
          </Curve>
          <Curve name="initialScale">
            <KeyFrame>0, 2, 2</KeyFrame>
            <KeyFrame>1, 2.5, 2.5</KeyFrame>
          </Curve>
          <Set name="lifeTime">1</Set>
        </Particle>
      </ParticleSystem>

      <ParticleSystem name="ps_flashOutline" renderStage="RenderChestItem">
        <Emitter>
          <Set name="offset">0, -16</Set>
          <Set name="emissionInterval">0.1</Set>
          <Set name="infParticles">true</Set>
          <Set name="infLifeTime">true</Set>
          <Set name="checkParticleNumToEmit">true</Set>
          <Set name="particlesPerEmission">1</Set>
          <Set name="particlesToEmit">1</Set>
        </Emitter>
        <Particle usePlayerFacing="true">
          <Set name="sprite">s_outline</Set>
          <Set name="inSpecificOrder">true</Set>
          <Set name="blendingMode">PREMULTIPLIED_ALPHA</Set>
          <Set name="relativeToEmitter">true</Set>
          <Curve name="initialAlpha">
            <KeyFrame>0, 1</KeyFrame>
            <KeyFrame>0.4, 1</KeyFrame>
            <KeyFrame>1, 0</KeyFrame>
          </Curve>
          <Set name="lifeTime">0.5</Set>
        </Particle>
      </ParticleSystem>
      <ParticleSystem name="ps_deathSplash" updateStage="OnKilled" renderStage="RenderBehind">
        <Emitter>
          <Set name="lifeTime">1.3</Set>
          <Set name="infParticles">true</Set>
          <Set name="checkParticleNumToEmit">true</Set>
          <Set name="particlesPerEmission">1</Set>
          <Set name="particlesToEmit">1</Set>
          <Set name="useCharacterPos">true</Set>
          <Set name="offset">0,-24</Set>
        </Emitter>
        <Particle>
          <Set name="sprite">s_death</Set>
          <Set name="relativeToEmitter">true</Set>
          <Set name="inSpecificOrder">true</Set>
          <Set name="blendingMode">PREMULTIPLIED_ALPHA</Set>
		  <Curve name="initialAlpha">
            <KeyFrame>0, 1</KeyFrame>
            <KeyFrame>0.6, 1</KeyFrame>
            <KeyFrame>1, 0</KeyFrame>
          </Curve>
          <Set name="lifeTime">1.2</Set>
        </Particle>
      </ParticleSystem>
    </ParticleSystems>

    <RenderOptions>
      <Default>
        <Set name="IgnorePunchTypeCheck">true</Set>
        <Set name="IncludeAllActions">true</Set>
        <Set name="HideAvatarOnDeath">true</Set>
        <Set name="HideAngelOnDeath">true</Set>
      </Default>
    </RenderOptions>
  </Data>

  <RenderRules>
    <RenderInFront>
        <StopIf>
          <IsRenderMod>RENDER_MOD_MINI_YOU</IsRenderMod>
        </StopIf>
        <ParticleSystemRender name="ps_snowflake" onState="IsDying.False"/>
        <ParticleSystemRender name="ps_trail" onState="IsDying.False"/>
        <ParticleSystemRender name="ps_snowflake1" onState="IsDying.False"/>
        <ParticleSystemRender name="ps_trail1" onState="IsDying.False"/>
    </RenderInFront>
    <AddClothingParticles>
        <StopIf>
          <IsRenderMod>RENDER_MOD_MINI_YOU</IsRenderMod>
        </StopIf>
        <ParticleSystemUpdate name="ps_trail" onState="IsDying.False"/>
        <ParticleSystemUpdate name="ps_snowflake" onState="IsDying.False"/>
        <ParticleSystemUpdate name="ps_trail1" onState="IsDying.False"/>
        <ParticleSystemUpdate name="ps_snowflake1" onState="IsDying.False"/>
        <ParticleSystemUpdate name="ps_flash" onAction="JUMPDOUBLE" onState="IsDying.False"/>
        <ParticleSystemUpdate name="ps_flashOutline" onAction="JUMPDOUBLE" onState="IsDying.False"/>
    </AddClothingParticles>
    <RenderChestItem>
      <SpriteRender name="s_chest" blend="PREMULTIPLIED_ALPHA" alignment="DOWN_CENTER" />
    </RenderChestItem>
    <RenderChestBackItem>
      <SpriteRender name="s_glow" blend="PREMULTIPLIED_ALPHA" offset="0,-16" drawShadow="false" onState="IsDying.False" />
    </RenderChestBackItem>
  </RenderRules>
</ItemRenderer>
