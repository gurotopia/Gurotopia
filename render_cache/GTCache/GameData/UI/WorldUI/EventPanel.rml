<template name="EventPanel">
	<head>
		<title>EventPanel</title>
		<link type="text/rcss" href="../rml.rcss" />
		<link type="text/rcss" href="../BaseStyles.rcss" />
		<link type="text/rcss" href="EventPanel.rcss" />
		<link type="text/rcss" href="EventButtons/EventButtons.rcss" />
		<link type="text/template" href="EventButtons/BaseEventButton.rml" />
		<script lang="text/lua">
      function onFtuePanelShown(document)
      ftuePanel = document:GetElementById('ftueButtonPanel');
      ftueButton = document:GetElementById('FTUEButton');

      if not ftuePanel or
      not ftueButton or
      not ftueButton.offset_parent or
      not ftueButton.offset_parent.offset_parent or
      not ftueButton.parent_node
      then
      return
      end

      ftuePanel.style.top = (ftueButton.offset_top + ftueButton.offset_parent.offset_top - ftueButton.offset_parent.offset_parent.scroll_top)..'px';
      ftuePanel.style.left = (ftueButton.parent_node.client_width + ftueButton.offset_parent.offset_left)..'px';
      end

      function onToggleAuctionPanel(document)
      activeAuctionPanel = document:GetElementById('activeAuctionButtonPanel');
      activeAuctionButton = document:GetElementById('ActiveAuctionButton');

      if not activeAuctionPanel or
      not activeAuctionButton or
      not activeAuctionButton.offset_parent or
      not activeAuctionButton.offset_parent.offset_parent or
      not activeAuctionButton.parent_node
      then
      return
      end

      close = activeAuctionButton:IsClassSet('open')

      if close then
      activeAuctionButton:SetClass('open', false)
      activeAuctionPanel:SetClass('visible', false)
      activeAuctionPanel:SetClass('hidden', true)
      else
      activeAuctionButton:SetClass('open', true)
      activeAuctionPanel:SetClass('visible', true)
      activeAuctionPanel:SetClass('hidden', false)
      activeAuctionPanel.style.top = (activeAuctionButton.offset_top + activeAuctionButton.offset_parent.offset_top - activeAuctionButton.offset_parent.offset_parent.scroll_top)..'px';
      activeAuctionPanel.style.left = (activeAuctionButton.parent_node.client_width + activeAuctionButton.offset_parent.offset_left)..'px';
      end
      end

      function closeActiveAuctionPanel(document)
      activeAuctionPanel = document:GetElementById('activeAuctionButtonPanel');
      activeAuctionButton = document:GetElementById('ActiveAuctionButton');

      if not activeAuctionPanel or not activeAuctionButton
      then
      return
      end

      activeAuctionButton:SetClass('open', false)
      activeAuctionPanel:SetClass('visible', false)
      activeAuctionPanel:SetClass('hidden', true)
      end

    </script>
	</head>
	<body>
		<div id="events_panel" onscroll="OnEvent(event, 'event_buttons.scroll') closeActiveAuctionPanel(document)" class="scroll-on-top">
			<div data-model="EventButtons">
				<div data-for="eventButton : eventButtons" class="event_item" data-event-click="oneventclick(it_index, eventButton.buttonAction);" data-attr-id="eventButton.name" data-if="eventButton.visible">
					<div data-alias-buttonData="eventButton">
						<template src="BaseEventButton" />
					</div>
				</div>
			</div>
		</div>

		<div id="ftueButtonPanel" data-model="FTUEPanelModel" data-class-visible="visible"  data-class-hidden="!visible">
			<div id="panelContent">
				<div class="frame"></div>
				<div class="content">
					<div id="description">
						<div class="title color_pale_yellow" data-rml="ToRMLText(title)"></div>
						<div class="descriptopn" data-rml="ToRMLText(description)"></div>
					</div>
					<div id="buttons" data-if="buttonsVisible">
						<div id="phone" data-event-click="onphineclick"><div class="notification_icon" data-visible="state > 0 && notification"></div></div>
						<div id="scroll" data-event-click="onscrollclick" data-class-hidden="state == 0"></div>
						<div id="switcher" data-class-on="hintState == 1" class="on" data-event-click="onhintclick();"></div>
					</div>
				</div>

			</div>
			</div>

    <div id="activeAuctionButtonPanel" data-model="ActiveAuctionPanelModel" onactiveauctionend="closeActiveAuctionPanel(document)" class="hidden">
      <div id="panelContent">
        <div class="frame"></div>
        <div class="content">
          <table>
            <colgroup>
              <col id="col-1"/>
              <col id="col-2" />
            </colgroup>
            <tbody>
              <tr>
                <td id="item-name" rowspan="3">
                  <TruncatingString lines="2" break-word="true" data-attr-source="ItemName(ActiveAuctionPanel.itemId)"/>
                </td>
                <td id="bid-amount" class="color_dreamsicle">
                  Current Bid: <span class="color_yellow">{{MoneyString(ActiveAuctionPanel.highestBidWlCount, 1)}} WL</span>
                </td>
              </tr>
              <tr>
                <td id="bid-end-time" 
                    class="color_green" 
                    data-rml="ToRMLText(ActiveAuctionPanel.highestBidUserName)"
                    data-class-hidden="ActiveAuctionPanel.highestBidUserName == ''">
                </td>
              </tr>
              <tr>
                <td id="bid-end-time" class="color_dreamsicle">
                  <Timer data-attr-end-epoch="ActiveAuctionPanel.bidEndTime" sec-post-1m="true" onfinish="closeActiveAuctionPanel(document)">
                    <active>
                      <span class="color_dreamsicle">Expires In: </span>
                      <timertext class="color_pinky_purple"/>
                    </active>
                    <expired>Expired!</expired>
                  </Timer>
                </td>
              </tr>
              <tr>
                <td id="available-wl">
                  <div id="search-button" data-event-click="OpenAuctionSearch">
                    <div id="search-icon"/>
                  </div>
                  <div id="wls_panel">
                    <div class="panel" data-attrif-disabled="1">
                      <div id="wl_left_panel">
                        <div id="wl_icon"></div>
                      </div>
                      <div id="wl_right_panel">
                        {{MoneyString(ActiveAuctionPanel.availableLocks + ActiveAuctionPanel.alreadyBidLocks, 1)}}
                      </div>
                    </div>
                    <div id="plus_button" data-event-click="AddWorldLocks"></div>
                  </div>
                </td>
                <td id="bid-buttons">
                  <div data-class-hidden="ActiveAuctionPanel.isOwner" id="bid-buttons-container" >
                    <span id="bid-label" class="color_dreamsicle">Bid: </span>
                    <div data-for="bid : ActiveAuctionPanel.PossibleBids">
                      <div data-attr-bid_amount="bid" onclick="OnEvent(event, 'ActiveAuction.Bid')" class="img-button button-green-color" data-class-disabled="!ActiveAuctionPanel.canBid || bid > ActiveAuctionPanel.alreadyBidLocks + ActiveAuctionPanel.availableLocks - ActiveAuctionPanel.highestBidWlCount ">
                        <span class="label" data-class-hidden="!ActiveAuctionPanel.canBid">+{{bid}}</span>
                        <div class="loader" data-class-hidden="ActiveAuctionPanel.canBid">
                          <div class="bar1"></div>
                          <div class="bar2"></div>
                          <div class="bar3"></div>
                          <div class="bar4"></div>
                          <div class="bar5"></div>
                          <div class="bar6"></div>
                          <div class="bar7"></div>
                          <div class="bar8"></div>
                          <div class="bar9"></div>
                          <div class="bar10"></div>
                          <div class="bar11"></div>
                          <div class="bar12"></div>
                        </div>
                      </div>
                    </div>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
	</body>
</template>
